"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5745],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||p[m]||s;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},23463:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const s={sidebar_position:2},i="Deliver Project with Hybrid Resources",o={unversionedId:"user_docs/getting-started/usecases/deliver-hybrid-resources-project",id:"user_docs/getting-started/usecases/deliver-hybrid-resources-project",title:"Deliver Project with Hybrid Resources",description:"This tutorial will demonstrate how to deliver project with hybrid resources(The project requires both kubernetes resources and IaaS resources), all at one Kusion command.",source:"@site/docs/user_docs/getting-started/usecases/deliver-hybrid-resources-project.md",sourceDirName:"user_docs/getting-started/usecases",slug:"/user_docs/getting-started/usecases/deliver-hybrid-resources-project",permalink:"/docs/user_docs/getting-started/usecases/deliver-hybrid-resources-project",editUrl:"https://github.com/KusionStack/kusionstack.io/blob/main/docs/user_docs/getting-started/usecases/deliver-hybrid-resources-project.md",tags:[],version:"current",lastUpdatedBy:"amyxia",lastUpdatedAt:1678866617,formattedLastUpdatedAt:"3/15/2023",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"user_docs",previous:{title:"Deliver Your First Project on Kubernetes",permalink:"/docs/user_docs/getting-started/usecases/deliver-first-project"},next:{title:"KCL Quick Start",permalink:"/docs/user_docs/getting-started/kcl"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone Project",id:"clone-project",level:2},{value:"Review Config Files",id:"review-config-files",level:3},{value:"Delivery",id:"delivery",level:2},{value:"Validate and Configurate the OSS as WordPress&#39;s Storage",id:"validate-and-configurate-the-oss-as-wordpresss-storage",level:2}],d={toc:c};function p(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deliver-project-with-hybrid-resources"},"Deliver Project with Hybrid Resources"),(0,r.kt)("p",null,"This tutorial will demonstrate how to deliver project with hybrid resources(The project requires both kubernetes resources and IaaS resources), all at one Kusion command."),(0,r.kt)("p",null,"Unlike the previous Code-City usecase, this tutorial take a step further and will set up a WordPress site that requires resources from the IaaS layer - Aliyun OSS - as the cloud storage for media resources. That's common request for applications to save disk space for the server, reduce the workload of file migration when moving the website, and also avoid the limitation of server bandwidth when accessing files stored in independent cloud storage."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/user_docs/getting-started/install"},"Kusion")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/"},"Kubernetes")," or ",(0,r.kt)("a",{parentName:"li",href:"https://kind.sigs.k8s.io/"},"Kind")),(0,r.kt)("li",{parentName:"ul"},"This use case requires you to have an ",(0,r.kt)("strong",{parentName:"li"},"Aliyun account")," for utilizing its Object Storage Service (OSS)."),(0,r.kt)("li",{parentName:"ul"},"Additionally, ",(0,r.kt)("strong",{parentName:"li"},"a user account with AliyunOSSFullAccess permission")," is required, and you can create and manage it in the ",(0,r.kt)("a",{parentName:"li",href:"https://ram.console.aliyun.com/users/"},"Aliyun Resource Access Management (RAM) console"),". And you can configure the obtained AccessKey and SecretKey obtained as environment variables:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'export ALICLOUD_ACCESS_KEY="LTAI5txxx" # replace it with your AccessKey\nexport ALICLOUD_SECRET_KEY="nxuowIxxx" # replace it with your SecretKey\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Alternatively, Kusion provides a sensitive data management tool for handling the AccessKey and SecretKey mentioned above."))),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",src:n(59317).Z,width:"2310",height:"1582"})),(0,r.kt)("h2",{id:"clone-project"},"Clone Project"),(0,r.kt)("p",null,"Firstly, let's clone the Konfig repo and enter the root directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git clone git@github.com:KusionStack/konfig.git && cd konfig\n")),(0,r.kt)("p",null,"Then we can locate the WordPress project under the ",(0,r.kt)("inlineCode",{parentName:"p"},"appops/")," directory, which are composed of the folowing files:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"\u279c  konfig git:(main) \u2717 cd appops/wordpress && tree\n.\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 base\n\u2502\xa0\xa0 \u2514\u2500\u2500 base.k\n\u251c\u2500\u2500 dev\n\u2502\xa0\xa0 \u251c\u2500\u2500 ci-test\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 settings.yaml\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 stdout.golden.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 kcl.yaml\n\u2502\xa0\xa0 \u251c\u2500\u2500 main.k\n\u2502\xa0\xa0 \u2514\u2500\u2500 stack.yaml\n\u2514\u2500\u2500 project.yaml\n\n3 directories, 8 files\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"}," More details about the directory structure can be found in ",(0,r.kt)("a",{parentName:"p",href:"/docs/user_docs/concepts/konfig"},"Konfig"),"."))),(0,r.kt)("h3",{id:"review-config-files"},"Review Config Files"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# base/base.k\n# ...\nwordpress = frontend.Server {\n    name = "wordpress-deployment"\n    # Some code are omitted, the complete code can be found in [Konfig/appops/wordpress](https://github.com/KusionStack/konfig/tree/main/wordpress/base/base.k)\n    # volumes = {...}\n    # mainContainer = {...}\n    # services = {...}\n    \n    storage = storage.ObjectStorage {\n        objectStorageType = "aliyun_oss"\n        objectStorageAttr = storage.StorageAttr {\n            bucket = "kusion-wordpress-oss"\n            acl    = "public-read"\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Here, apart from the code that describes the application container and services(these source codes are omitted to save space), a ",(0,r.kt)("inlineCode",{parentName:"p"},"storage.ObjectStorage")," instance is assigned to the ",(0,r.kt)("inlineCode",{parentName:"p"},"frontend.Server.storage")," attribute to declare that the WordPress application claims an Aliyun OSS bucket with ",(0,r.kt)("inlineCode",{parentName:"p"},"kusion-wordpress-oss")," as name and ",(0,r.kt)("inlineCode",{parentName:"p"},"public-read")," acl."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"More details about Konfig Models can be found in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/KusionStack/konfig"},"Konfig")))),(0,r.kt)("h2",{id:"delivery"},"Delivery"),(0,r.kt)("p",null,"We can deliver the WordPress Site into the Kubernetes cluster in both ways:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open the ",(0,r.kt)("inlineCode",{parentName:"li"},"appops/wordpress/dev/main.k")," file in VS Code IDE, and right click on the editor to select ",(0,r.kt)("inlineCode",{parentName:"li"},"Preview Live Diff and Apply"),' menu item. This operation will deploy the kubernetes resources required for launching the WordPress application and create an OSS bucket named "kusion-wordpress-oss" with public-read permissions.')),(0,r.kt)("p",null,"Then after all resources reconciled, we can click the ",(0,r.kt)("inlineCode",{parentName:"p"},"port-forward")," button popped up in the right bottom to forward the local port to the wordpress frontend service port in the cluster, and click ",(0,r.kt)("inlineCode",{parentName:"p"},"Open In Browser")," to visit the WordPress Site we just delivered in our default browser."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find and install VS Code Kusion extension in the ",(0,r.kt)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=KusionStack.kusion"},"VS Code Extension Market")))),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"apply wordpress with VS Code Kusion extension",src:n(15772).Z,width:"2616",height:"1706"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Use the Kusion Cli:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd appops/wordpress/dev && kusion apply --watch\n")),(0,r.kt)("p",null,"After all resources reconciled, we can port-forward our local port to the wordpress frontend service port in the cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"\u279c  dev git:(main) \u2717 kubectl port-forward -n wordpress-example svc/wordpress 12345:80\nForwarding from 127.0.0.1:12345 -> 80\nForwarding from [::1]:12345 -> 80\n")),(0,r.kt)("p",null,"Then visit ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:12345"},"http://localhost:12345")," to access to the WordPress Site in our browser."),(0,r.kt)("h2",{id:"validate-and-configurate-the-oss-as-wordpresss-storage"},"Validate and Configurate the OSS as WordPress's Storage"),(0,r.kt)("p",null,"To get started with the WordPress site we just delivered, we need to first complete the installation and login to the site. Then in the WordPress's management sidebar, navigate to the ",(0,r.kt)("inlineCode",{parentName:"p"},"plugins")," tab and click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Install Plugins"),', and search for the "Aliyun OSS" plugin and install it.'),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"set up the WordPress Site",src:n(97737).Z,width:"2616",height:"1706"})),(0,r.kt)("p",null,"As the ",(0,r.kt)("inlineCode",{parentName:"p"},"Aliyun OSS")," plugin successfully installed, we then need to set up the plugin to use the OSS bucket we previously created. Fill in the AccessKey and SecretKey with Read/Write access to that bucket. The AccessKey and SecretKey can be created and obtained from the ",(0,r.kt)("a",{parentName:"p",href:"https://ram.console.aliyun.com/users/"},"Aliyun Resource Access Management (RAM) console"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"set up the OSS Aliyun plugin",src:n(87501).Z,width:"2616",height:"1706"})),(0,r.kt)("p",null,'Once the configuration is complete, we can edit our blog post and upload images, such as the Kusion icon image in this case. Then click on the "Preview Changes" button, and we should see that the image has actually been uploaded to our OSS bucket.'),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"upload kusion icon",src:n(68455).Z,width:"2616",height:"1706"})))}p.isMDXComponent=!0},59317:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/set-oss-access-a2a37cc19e088e4c55f2a5e30bc9dd19.png"},15772:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wordpress-apply-a87d49ac502e71ac35429e41ce6ac055.gif"},68455:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wordpress-oss-validation-e073aa0f6982a40e7746c7aac29c3322.gif"},87501:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wordpress-setup-plugin-fcf420bd192d7495fd55bb911ff0db3a.gif"},97737:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wordpress-setup-29021b9f69af1f416c294e83843783e2.gif"}}]);