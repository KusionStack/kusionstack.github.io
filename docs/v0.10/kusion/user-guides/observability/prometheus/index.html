<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v0.10 plugin-docs plugin-id-default docs-doc-id-kusion/user-guides/observability/prometheus">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Configure Monitoring Behavior With Prometheus | Evolve Your Internal Developer Platform with KusionStack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kusionstack.io/docs/v0.10/kusion/user-guides/observability/prometheus"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v0.10"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v0.10"><meta data-rh="true" name="docsearch:version" content="v0.10"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v0.10"><meta data-rh="true" property="og:title" content="Configure Monitoring Behavior With Prometheus | Evolve Your Internal Developer Platform with KusionStack"><meta data-rh="true" name="description" content="This document provides the step-by-step instruction to set up monitoring for your application."><meta data-rh="true" property="og:description" content="This document provides the step-by-step instruction to set up monitoring for your application."><link data-rh="true" rel="icon" href="/img/kusionstack-icon-square.png"><link data-rh="true" rel="canonical" href="https://kusionstack.io/docs/v0.10/kusion/user-guides/observability/prometheus"><link data-rh="true" rel="alternate" href="https://kusionstack.io/docs/v0.10/kusion/user-guides/observability/prometheus" hreflang="en"><link data-rh="true" rel="alternate" href="https://kusionstack.io/docs/v0.10/kusion/user-guides/observability/prometheus" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RE5E6BQUZV-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Evolve Your Internal Developer Platform with KusionStack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Evolve Your Internal Developer Platform with KusionStack Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XC4Z27TLBR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XC4Z27TLBR",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Evolve Your Internal Developer Platform with KusionStack" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.81e4895b.css">
<link rel="preload" href="/assets/js/runtime~main.70df1276.js" as="script">
<link rel="preload" href="/assets/js/main.dd54d38d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like KusionStack, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/KusionStack/kusion">Github</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kusionstack-icon.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/kusionstack-icon-white.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">KusionStack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/v0.10/">Kusion</a><a class="navbar__item navbar__link" href="/docs/v0.10/operating/introduction/">Operating</a><a class="navbar__item navbar__link" href="/docs/v0.10/ctrlmesh/intro/">ControllerMesh</a><a class="navbar__item navbar__link" href="/docs/v0.10/community/intro/">Community</a><a href="https://blog.kusionstack.io" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v0.10/">v0.10</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/kusion/user-guides/observability/prometheus">v0.12 üöß</a></li><li><a class="dropdown__link" href="/docs/kusion/user-guides/observability/prometheus">v0.11</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v0.10/kusion/user-guides/observability/prometheus">v0.10</a></li><li><a class="dropdown__link" href="/docs/v0.9/">v0.9</a></li></ul></div><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/">What is Kusion?</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/kusion/getting-started/install-kusion">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/kusion/concepts/project/overview">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/kusion/configuration-walkthrough/overview">Configuration Walkthrough</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/v0.10/kusion/user-guides/cloud-resources/database">User Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.10/kusion/user-guides/cloud-resources/database">Cloud Resources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.10/kusion/user-guides/working-with-k8s/deploy-application">Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/v0.10/kusion/user-guides/observability/prometheus">Automated Observability</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v0.10/kusion/user-guides/observability/prometheus">Configure Monitoring Behavior With Prometheus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.10/kusion/user-guides/github-actions/deploy-application-via-github-actions">GitHub Actions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.10/kusion/user-guides/secrets-management/using-cloud-secrets">Secrets Management</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/kusion/reference/commands/">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.10/kusion/faq/install-error">FAQ</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Evolve Your Internal Developer Platform with KusionStack<!-- --> <b>v0.10</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/kusion/user-guides/observability/prometheus">latest version</a></b> (<!-- -->v0.11<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">User Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Automated Observability</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configure Monitoring Behavior With Prometheus</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.10</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configure Monitoring Behavior With Prometheus</h1><p>This document provides the step-by-step instruction to set up monitoring for your application. </p><p>As of today, Kusion supports the configuration of Prometheus scraping behaviors for the target application. In the future, we will add more cloud-provider-native solutions, such as AWS CloudWatch, Azure Monitor, etc.</p><p>The user guide below is composed of the following components:</p><ul><li>Namespace</li><li>Deployment</li><li>Service</li><li>ServiceMonitor</li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>This guide requires you to have a basic understanding of Kubernetes and Prometheus.
If you are not familiar with the relevant concepts, please refer to the links below:</p><ul><li><a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/" target="_blank" rel="noopener noreferrer">Learn Kubernetes Basics</a></li><li><a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener noreferrer">Prometheus Introduction</a></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisite">Pre-requisite<a href="#pre-requisite" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><p>Please refer to the <a href="/docs/v0.10/kusion/user-guides/working-with-k8s/deploy-application#prerequisites">prerequisites</a> in the guide for deploying an application.</p><p>The example below also requires you to have <a href="/docs/v0.10/kusion/user-guides/working-with-k8s/deploy-application#initializing">initialized the project</a> using the <code>kusion init</code> command, which will generate a <a href="/docs/v0.10/kusion/user-guides/working-with-k8s/deploy-application#kclmod"><code>kcl.mod</code> file</a> under the project directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-your-own-prometheus">Setting up your own Prometheus<a href="#setting-up-your-own-prometheus" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><p>There a quite a few ways to set up Prometheus in your cluster:</p><ol><li>Installing a Prometheus operator</li><li>Installing a standalone Prometheus server</li><li>Installing a Prometheus agent and connect to a remote Prometheus server</li></ol><p><a href="https://github.com/prometheus-operator/prometheus-operator/issues/1547#issuecomment-401092041" target="_blank" rel="noopener noreferrer">The advice from the Prometheus team</a> is to use the <code>ServiceMonitor</code> or <code>PodMonitor</code> CRs via the Prometheus operator to manage scrape configs going forward<sup>[2]</sup>.</p><p>In either case, you only have to do this setup once per cluster. This doc will use a minikube cluster and Prometheus operator as an example.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-prometheus-operator3">Installing Prometheus operator<sup>[3]</sup>.<a href="#installing-prometheus-operator3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>To get the example in this user guide working, all you need is a running Prometheus operator. You can have that installed by running:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LATEST=$(curl -s https://api.github.com/repos/prometheus-operator/prometheus-operator/releases/latest | jq -cr .tag_name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://github.com/prometheus-operator/prometheus-operator/releases/download/${LATEST}/bundle.yaml | kubectl create -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will install all the necessary CRDs and the Prometheus operator itself in the default namespace. Wait a few minutes, you can confirm the operator is up by running: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl wait --for=condition=Ready pods -l  app.kubernetes.io/name=prometheus-operator -n default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-sure-rbac-is-properly-set-up">Make sure RBAC is properly set up<a href="#make-sure-rbac-is-properly-set-up" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>If you have RBAC enabled on the cluster, the following must be created for Prometheus to work properly:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - nodes/metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - configmaps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - networking.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ingresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- nonResourceURLs: [&quot;/metrics&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  verbs: [&quot;get&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-prometheus-instance-via-the-operator">Configure Prometheus instance via the operator<a href="#configure-prometheus-instance-via-the-operator" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>Once all of the above is set up, you can then configure the Prometheus instance via the operator:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: monitoring.coreos.com/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceAccountName: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceMonitorNamespaceSelector: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceMonitorSelector: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  podMonitorNamespaceSelector: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  podMonitorSelector: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      memory: 400Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This Prometheus instance above will be cluster-wide, picking up ALL the service monitors and pod monitors across ALL the namespaces.
You can adjust the requests and limits accordingly if you have a larger cluster.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exposing-the-prometheus-portal-optional">Exposing the Prometheus portal (optional)<a href="#exposing-the-prometheus-portal-optional" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>Once you have the managed Prometheus instance created via the Prometheus CR above, you should be able to see a service created called <code>prometheus-operated</code>:</p><p><img loading="lazy" alt="prometheus-operated" src="/assets/images/prometheus-operated-4cf8308703e4ec9d06a5078bbceb8d5d.png" width="631" height="52" class="img_ev3q"></p><p>If you are also running on minikube, you can expose it onto your localhost via kubectl:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward svc/prometheus-operated 9099:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should then be able to see the Prometheus portal via <code>localhost:9099</code> in your browser:</p><p><img loading="lazy" alt="prometheus-portal" src="/assets/images/prometheus-portal-b60d8654c309e675fc04f1e74c5c127a.png" width="2878" height="1096" class="img_ev3q"></p><p>If you are running a non-local cluster, you can try to expose it via another way, through an ingress controller for example.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-workspace-configs">Setting up workspace configs<a href="#setting-up-workspace-configs" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><p>Since v0.10.0, we have introduced the concept of <a href="/docs/v0.10/kusion/concepts/workspace">workspaces</a>, whose configurations represent the part of the application behaviors that platform teams are interested in standardizing, or the ones to eliminate from developer&#x27;s mind to make their lives easier.</p><p>In the case of setting up Prometheus, there are a few things to set up on the workspace level:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="operator-mode">Operator mode<a href="#operator-mode" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>The <code>operatorMode</code> flag indicates to Kusion whether the Prometheus instance installed in the cluster runs as a Kubernetes operator or not. This determines the different kinds of resources Kusion manages.</p><p>To see more about different ways to run Prometheus in the Kubernetes cluster, please refer to the <a href="https://github.com/KusionStack/kusion/blob/main/docs/prometheus.md#prometheus-installation" target="_blank" rel="noopener noreferrer">design documentation</a>.</p><p>Most cloud vendors provide an out-of-the-box monitoring solutions for workloads running in a managed-Kubernetes cluster (EKS, AKS, etc), such as AWS CloudWatch, Azure Monitor, etc. These solutions mostly involve installing an agent (CloudWatch Agent, OMS Agent, etc) in the cluster and collecting the metrics to a centralized monitoring server. In those cases, you don&#x27;t need to set <code>operatorMode</code> to <code>True</code>. It only needs to be set to <code>True</code> when you have an installation of the <a href="https://github.com/prometheus-operator/prometheus-operator" target="_blank" rel="noopener noreferrer">Prometheus operator</a> running inside the Kubernetes cluster.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>For differences between <a href="https://github.com/prometheus-operator/prometheus-operator" target="_blank" rel="noopener noreferrer">Prometheus operator</a>, <a href="https://github.com/prometheus-operator/kube-prometheus" target="_blank" rel="noopener noreferrer">kube-prometheus</a> and the <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack" target="_blank" rel="noopener noreferrer">community kube-prometheus-stack helm chart</a>, the details are documented <a href="https://github.com/prometheus-operator/prometheus-operator#prometheus-operator-vs-kube-prometheus-vs-community-helm-chart" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-types">Monitor types<a href="#monitor-types" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>The <code>monitorType</code> flag indicates the kind of monitor Kusion will create. It only applies when <code>operatorMode</code> is set to <code>True</code>. As of version 0.10.0, Kusion provides options to scrape metrics from either the application pods or its corresponding Kubernetes services. This determines the different kinds of resources Kusion manages when Prometheus runs as an operator in the target cluster.</p><p>A sample <code>workspace.yaml</code> with Prometheus settings:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      operatorMode: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      monitorType: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scheme: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      interval: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To instruct Prometheus to scrape from pod targets instead:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      operatorMode: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      monitorType: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scheme: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      interval: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the <code>prometheus</code> section is missing from the <code>workspace.yaml</code>, Kusion defaults <code>operatorMode</code> to false.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overriding-with-projectselector">Overriding with projectSelector<a href="#overriding-with-projectselector" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h3><p>Workspace configurations contain a set of default setting group for all projects in the workspace, with means to override them by Projects using a <code>projectSelector</code> keyword.</p><p>Projects with the name matching those in projectSelector will use the values defined in that override group instead of the default. If a key is not present in the override group, the default value will be used.</p><p>Take a look at the sample <code>workspace.yaml</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      operatorMode: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      monitorType: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scheme: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      interval: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    low_frequency:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      operatorMode: False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      interval: 2m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      projectSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - foobar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    high_frequency:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      monitorType: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      projectSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, a project with the name <code>helloworld</code> will have the monitoring settings where <code>operatorMode</code> is set to <code>False</code>, a 2 minute scraping interval, 15 seconds timeout (coming from default) and http scheme (coming from default).</p><p>You cannot have the same project appear in two projectSelectors.</p><p>For a full reference of what can be configured in the workspace level, please see the <a href="/docs/v0.10/kusion/reference/modules/workspace-configs/monitoring/prometheus">workspace reference</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="updating-the-workspace-config">Updating the workspace config<a href="#updating-the-workspace-config" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><p>Assuming you now have a <code>workspace.yaml</code> that looks like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      operatorMode: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      monitorType: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scheme: http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      interval: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Update the workspace configuration by running the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kusion workspace update dev -f workspace.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify the workspace config is properly updated by running the command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kusion workspace show dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-kusion-to-deploy-your-application-with-monitoring-requirements">Using kusion to deploy your application with monitoring requirements<a href="#using-kusion-to-deploy-your-application-with-monitoring-requirements" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><p>At this point we are set up for good! Any new applications you deploy via kusion will now automatically have the monitoring-related resources created, should you declare you want it via the <code>monitoring</code> field in the <code>AppConfiguration</code> model.</p><p>The monitoring in an AppConfiguration is declared in the <code>monitoring</code> field. See the example below for a full, deployable AppConfiguration.</p><p>Please note we are using a new image <code>quay.io/brancz/prometheus-example-app</code> since the app itself need to expose metrics for Prometheus to scrape:</p><p><code>helloworld/dev/main.k</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import catalog.models.schema.v1 as ac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import catalog.models.schema.v1.workload as wl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import catalog.models.schema.v1.workload.container as c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import catalog.models.schema.v1.monitoring as m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import catalog.models.schema.v1.workload.network as n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helloworld: ac.AppConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workload: wl.Service {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        containers: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;monitoring-sample-app&quot;: c.Container {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image: &quot;quay.io/brancz/prometheus-example-app:v0.3.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            n.Port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                port: 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monitoring: m.Prometheus{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path:           &quot;/metrics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The KCL file above represents an application with a service type workload, exposing the port 8080, and would like Prometheus to scrape the <code>/metrics</code> endpoint every 2 minutes.</p><p>Running <code>kusion apply</code> would show that kusion will create a <code>Namespace</code>, a <code>Deployment</code>, a <code>Service</code> and a <code>ServiceMonitor</code>:
<img loading="lazy" alt="kusion-apply-with-monitor" src="/assets/images/kusion-apply-with-monitor-d27cd1443e1a324d514983d52c055b15.png" width="705" height="224" class="img_ev3q"></p><p>Continue applying all resources:
<img loading="lazy" alt="kusion-apply-success" src="/assets/images/kusion-apply-success-52d04db670fd184959c3ea5c9e54f69d.png" width="1047" height="564" class="img_ev3q"></p><p>If we want to, we can verify the service monitor has been created successfully:
<img loading="lazy" alt="service-monitor" src="/assets/images/service-monitor-2374625bfd1180a978a2be50ad4648ce.png" width="693" height="463" class="img_ev3q"></p><p>In a few seconds, you should be able to see in the Prometheus portal that the service we just deployed has now been discovered and monitored by Prometheus:
<img loading="lazy" alt="prometheus-targets" src="/assets/images/prometheus-targets-05964bad58af16f2e02c57cafa8565e7.png" width="2880" height="1636" class="img_ev3q"></p><p>You can run a few simply queries for the data that Prometheus scraped from your application:
<img loading="lazy" alt="prometheus-simple-query" src="/assets/images/prometheus-simple-query-60205589e762105ebc850e70d8ea7b56.png" width="2880" height="1634" class="img_ev3q"></p><p>For more info about PromQL, you can find them <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank" rel="noopener noreferrer">here</a><sup>[4]</sup>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">‚Äã</a></h2><ol><li>Prometheus: <a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/introduction/overview/</a></li><li>Prometheus team advise: <a href="https://github.com/prometheus-operator/prometheus-operator/issues/1547#issuecomment-446691500" target="_blank" rel="noopener noreferrer">https://github.com/prometheus-operator/prometheus-operator/issues/1547#issuecomment-446691500</a></li><li>Prometheus operator getting started doc: <a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md" target="_blank" rel="noopener noreferrer">https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md</a></li><li>PromQL basics: <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/prometheus/latest/querying/basics/</a></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/KusionStack/kusionstack.io/blob/main/versioned_docs/version-v0.10/kusion/5-user-guides/3-observability/1-prometheus.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-04-01T09:47:24.000Z">Apr 1, 2024</time></b> by <b>Dayuan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v0.10/kusion/user-guides/working-with-k8s/job"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Schedule a Job</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v0.10/kusion/user-guides/github-actions/deploy-application-via-github-actions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploy Application Securely and Efficiently via GitHub Actions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pre-requisite" class="table-of-contents__link toc-highlight">Pre-requisite</a></li><li><a href="#setting-up-your-own-prometheus" class="table-of-contents__link toc-highlight">Setting up your own Prometheus</a><ul><li><a href="#installing-prometheus-operator3" class="table-of-contents__link toc-highlight">Installing Prometheus operator<sup>3</sup>.</a></li><li><a href="#make-sure-rbac-is-properly-set-up" class="table-of-contents__link toc-highlight">Make sure RBAC is properly set up</a></li><li><a href="#configure-prometheus-instance-via-the-operator" class="table-of-contents__link toc-highlight">Configure Prometheus instance via the operator</a></li><li><a href="#exposing-the-prometheus-portal-optional" class="table-of-contents__link toc-highlight">Exposing the Prometheus portal (optional)</a></li></ul></li><li><a href="#setting-up-workspace-configs" class="table-of-contents__link toc-highlight">Setting up workspace configs</a><ul><li><a href="#operator-mode" class="table-of-contents__link toc-highlight">Operator mode</a></li><li><a href="#monitor-types" class="table-of-contents__link toc-highlight">Monitor types</a></li><li><a href="#overriding-with-projectselector" class="table-of-contents__link toc-highlight">Overriding with projectSelector</a></li></ul></li><li><a href="#updating-the-workspace-config" class="table-of-contents__link toc-highlight">Updating the workspace config</a></li><li><a href="#using-kusion-to-deploy-your-application-with-monitoring-requirements" class="table-of-contents__link toc-highlight">Using kusion to deploy your application with monitoring requirements</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Document</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Kusion</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ctrlmesh/intro/">ControllerMesh</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resource</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.kusionstack.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/kusionstack/shared_invite/zt-19lqcc3a9-_kTNwagaT5qwBE~my5Lnxg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">KCL</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.antgroup.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.svg" alt="AntGroup Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="160" height="51"><img src="/img/oss_logo.svg" alt="AntGroup Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="160" height="51"></a></div><div class="footer__copyright">Copyright ¬© 2022 KusionStack Authors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.70df1276.js"></script>
<script src="/assets/js/main.dd54d38d.js"></script>
</body>
</html>