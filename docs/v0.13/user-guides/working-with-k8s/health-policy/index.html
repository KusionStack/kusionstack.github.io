<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v0.13 plugin-docs plugin-id-docs docs-doc-id-user-guides/working-with-k8s/health-policy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Customized Health Check with KCL | Transform Your Internal Developer Platform with KusionStack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kusionstack.io/docs/v0.13/user-guides/working-with-k8s/health-policy"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v0.13"><meta data-rh="true" name="docusaurus_tag" content="docs-docs-v0.13"><meta data-rh="true" name="docsearch:version" content="v0.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs-v0.13"><meta data-rh="true" property="og:title" content="Customized Health Check with KCL | Transform Your Internal Developer Platform with KusionStack"><meta data-rh="true" name="description" content="Kusion now offers advanced customized health checks leveraging the power of KCL. This robust feature empowers users to define complex and tailored health policies for their Kubernetes resources. By implementing these custom policies, you can ensure that your resources not only meet specific criteria but also satisfy complex conditions before being deemed healthy. This capability is particularly valuable when assessing the health status of Kubernetes Custom Resources (CRs), providing a flexible and precise mechanism to validate the state of your entire project."><meta data-rh="true" property="og:description" content="Kusion now offers advanced customized health checks leveraging the power of KCL. This robust feature empowers users to define complex and tailored health policies for their Kubernetes resources. By implementing these custom policies, you can ensure that your resources not only meet specific criteria but also satisfy complex conditions before being deemed healthy. This capability is particularly valuable when assessing the health status of Kubernetes Custom Resources (CRs), providing a flexible and precise mechanism to validate the state of your entire project."><link data-rh="true" rel="icon" href="/img/kusionstack-icon-square.png"><link data-rh="true" rel="canonical" href="https://kusionstack.io/docs/v0.13/user-guides/working-with-k8s/health-policy"><link data-rh="true" rel="alternate" href="https://kusionstack.io/docs/v0.13/user-guides/working-with-k8s/health-policy" hreflang="en"><link data-rh="true" rel="alternate" href="https://kusionstack.io/zh/docs/v0.13/user-guides/working-with-k8s/health-policy" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kusionstack.io/docs/v0.13/user-guides/working-with-k8s/health-policy" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Transform Your Internal Developer Platform with KusionStack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Transform Your Internal Developer Platform with KusionStack Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XC4Z27TLBR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XC4Z27TLBR",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Transform Your Internal Developer Platform with KusionStack" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5bb6c965.css">
<link rel="preload" href="/assets/js/runtime~main.d184186e.js" as="script">
<link rel="preload" href="/assets/js/main.a76020de.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like KusionStack, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/KusionStack/kusion">Github</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kusionstack-icon.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/kusionstack-icon-white.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">KusionStack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/v0.13/">Kusion</a><a class="navbar__item navbar__link" href="/karpor/">Karpor</a><a class="navbar__item navbar__link" href="/kuperator/introduction/">Kuperator</a><a class="navbar__item navbar__link" href="/ctrlmesh/intro/">Ctrlmesh</a><a class="navbar__item navbar__link" href="/community/intro/">Community</a><a href="https://blog.kusionstack.io" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v0.13/">v0.13</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">v0.15 üöß</a></li><li><a class="dropdown__link" href="/docs/">v0.14</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v0.13/user-guides/working-with-k8s/health-policy">v0.13</a></li><li><a class="dropdown__link" href="/docs/v0.12/">v0.12</a></li><li><a class="dropdown__link" href="/docs/v0.11/">v0.11</a></li><li><a class="dropdown__link" href="/docs/v0.10/">v0.10</a></li><li><a class="dropdown__link" href="/docs/v0.9/">v0.9</a></li></ul></div><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-docs-v0.13,docs-ctrlmesh-v0.1,docs-community-current,docs-karpor-v0.6,docs-kuperator-v0.6"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/">What is Kusion?</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/getting-started/install-kusion">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/concepts/overview">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/configuration-walkthrough/overview">Configuration Walkthrough</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/v0.13/user-guides/cloud-resources/database">User Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.13/user-guides/cloud-resources/database">Cloud Resources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/deploy-application">Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/deploy-application">Deploy Application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/container">Configure Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/service">Expose Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/image-upgrade">Upgrade Image</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/resource-spec">Configure Resource Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/set-up-operational-rules">Set up Operational Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/job">Schedule a Job</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/k8s-manifest">Apply the Raw K8s Manifest YAML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v0.13/user-guides/working-with-k8s/health-policy">Customized Health Check with KCL</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.13/user-guides/observability/prometheus">Automated Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.13/user-guides/secrets-management/using-cloud-secrets">Secrets Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.13/user-guides/production-practice-case/collaborate-with-github-actions">Production Practice Case</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/v0.13/user-guides/llm-ops/inference">LLM Ops</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/reference/commands/">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v0.13/faq/install-error">FAQ</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Transform Your Internal Developer Platform with KusionStack<!-- --> <b>v0.13</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/">latest version</a></b> (<!-- -->v0.14<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">User Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kubernetes</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Customized Health Check with KCL</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Customized Health Check with KCL</h1><p>Kusion now offers advanced customized health checks leveraging the power of <code>KCL</code>. This robust feature empowers users to define complex and tailored health policies for their Kubernetes resources. By implementing these custom policies, you can ensure that your resources not only meet specific criteria but also satisfy complex conditions before being deemed healthy. This capability is particularly valuable when assessing the health status of Kubernetes Custom Resources (CRs), providing a flexible and precise mechanism to validate the state of your entire <code>project</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">‚Äã</a></h2><p>Please refer to the <a href="/docs/v0.13/user-guides/working-with-k8s/deploy-application#prerequisites">prerequisites</a> in the guide for deploying an application.</p><p>The example below also requires you to have <a href="/docs/v0.13/user-guides/working-with-k8s/deploy-application#initializing">initialized the project</a> using the <code>kusion workspace create</code> and <code>kusion init</code> command, which will create a workspace and also generate a <a href="/docs/v0.13/user-guides/working-with-k8s/deploy-application#kclmod"><code>kcl.mod</code> file</a> under the stack directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-a-health-policy">Defining a Health Policy<a href="#defining-a-health-policy" class="hash-link" aria-label="Direct link to Defining a Health Policy" title="Direct link to Defining a Health Policy">‚Äã</a></h2><p>You can define a health policy in the <code>Workspace</code> configuration via the <code>healthPolicy</code> field. The <code>healthPolicy</code> should contain a KCL script that defines the health check logic and can be used to assert healthy conditions on your <code>Kubernetes</code> resources.</p><p>Firstly, you need to initialize the workspace configuration:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/$ </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> ~/dev.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~/$ kusion workspace create dev -f ~/dev.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create workspace dev successfully</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-health-policy">Example Health Policy<a href="#example-health-policy" class="hash-link" aria-label="Direct link to Example Health Policy" title="Direct link to Example Health Policy">‚Äã</a></h3><p>Here is an example of how to define a health policy for a Kubernetes Deployment. This policy checks multiple aspects of the Deployment&#x27;s health status. Update ~/dev.yaml with this example:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">modules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">healthPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">health.kcl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        assert res.metadata.generation == res.status.observedGeneration</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        assert res.status.replicas == 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the custom health check ensures that:</p><ol><li>The Deployment has 1 replicas</li><li>The observed generation matches the current generation (indicating that the latest changes have been processed)</li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><code>res</code> represents the Kubernetes resource being evaluated. It&#x27;s a fixed expression in this feature that provides access to all fields and properties of the resource. You can use dot notation (e.g., <code>res.metadata.name</code>) to access nested fields within the resource. This allows you to create complex health checks based on various aspects of your Kubernetes resources.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How It Works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works">‚Äã</a></h2><p>When you apply your configuration, <code>kusion</code> will patch the provided <code>KCL</code> script into the <code>extension</code> field of the specified resource in the <code>Spec</code> and use the provided KCL script to evaluate the health of this resource. The health check will be performed repeatedly until it passes or a timeout is reached.</p><p>The KCL script has access to the full Kubernetes resource object through the <code>res</code> variable. You can use any fields or properties of the resource in your health check logic.</p><p>Besides configuring the workspace, platform engineers can also utilize the useful <code>PatchHealthPolicyToExtension</code> function in SDK to perform this feature while constructing the <code>module</code>. This function allows for a more programmatic and flexible approach to applying health policies while it&#x27;s multiple resources case for a module.</p><p>Here&#x27;s a code snippet of how to use the <code>PatchHealthPolicyToExtension</code> function:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Generate Kusion resource ID and wrap the Kubernetes Service into Kusion resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// with the SDK provided by kusion module framework.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resourceID := module.KubernetesResourceID(svc.TypeMeta, svc.ObjectMeta)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource, err := module.WrapK8sResourceToKusionResource(resourceID, svc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module.PatchHealthPolicyToExtension(resource, &quot;assert res.metadata.generation == res.status.observedGeneration&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="applying-the-health-policy">Applying the Health Policy<a href="#applying-the-health-policy" class="hash-link" aria-label="Direct link to Applying the Health Policy" title="Direct link to Applying the Health Policy">‚Äã</a></h2><p>To apply the health policy, update your workspace configuration:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/$ kusion workspace update dev -f ~/dev.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update workspace dev successfully</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After updating the workspace configuration, apply your new configuration with the customized health check with the following commands:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/$ </span><span class="token builtin class-name">cd</span><span class="token plain"> quickstart/default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~/quickstart/default/$ kusion apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Generating Spec </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the Stack default</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stack: default                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID                                                           Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v1:Namespace:quickstart                                      Create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v1:Service:quickstart:quickstart-default-quickstart-private  Create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apps/v1:Deployment:quickstart:quickstart-default-quickstart  Create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Do you want to apply these diffs?: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start applying diffs </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Succeeded v1:Namespace:quickstart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚£Ω  Creating v1:Service:quickstart:quickstart-default-quickstart-private </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Succeeded v1:Namespace:quickstart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚¢ø  Creating v1:Service:quickstart:quickstart-default-quickstart-private </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚¢ø  Creating apps/v1:Deployment:quickstart:quickstart-default-quickstart </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Succeeded v1:Namespace:quickstart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Succeeded v1:Service:quickstart:quickstart-default-quickstart-private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ‚úîÔ∏é  Succeeded apps/v1:Deployment:quickstart:quickstart-default-quickstart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Apply complete</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> Resources: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> created, </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> updated, </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> deleted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">v1:Namespace:quickstart</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind            Name        Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Namespace       quickstart  Phase: Active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  ServiceAccount  default     Secrets: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, Age: 0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">v1:Service:quickstart:quickstart-default-quickstart-private</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind           Name                                         Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Service        quickstart-default-quickstart-private        Type: ClusterIP, InternalIP: </span><span class="token number" style="color:#36acaa">10.96</span><span class="token plain">.196.38, ExternalIP: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">, Port</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  EndpointSlice  quickstart-default-quickstart-private-v42zc  AddressType: IPv4, Ports: </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">, Endpoints: </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.1.99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">apps/v1:Deployment:quickstart:quickstart-default-quickstart</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind        Name                                            Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Deployment  quickstart-default-quickstart                   Reconciled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  ReplicaSet  quickstart-default-quickstart-67459cd68d        Desired: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, Current: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, Ready: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Pod         quickstart-default-quickstart-67459cd68d-jqtt7  Ready: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1, Status: Running, Restart: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, Age: 4s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="explanation">Explanation<a href="#explanation" class="hash-link" aria-label="Direct link to Explanation" title="Direct link to Explanation">‚Äã</a></h2><p>The <code>Detail</code> column for the Deployment <code>quickstart-default-quickstart</code> provides crucial information about the resource&#x27;s reconciliation status:</p><ul><li>If it shows &quot;Reconciled&quot;, it means the resource has successfully met the conditions defined in the health policy.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind        Name                                 Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Deployment  quickstart-default-quickstart        Reconciled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>If it displays &quot;Reconciling...&quot;, it indicates that the resource is still in the process of reaching the desired state as per the health policy.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind        Name                                 Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODIFIED  Deployment  quickstart-default-quickstart     Reconciling</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>In case of any errors or unsupported configurations, appropriate messages will be shown, and customized health check will be skipped.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Type   Kind        Name                                 Detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READY  Deployment  quickstart-default-quickstart        health policy err: invalid syntax error, skip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This <code>Detail</code> helps you quickly assess whether your Kubernetes resources have reached their intended state after applying changes. It&#x27;s an essential feedback mechanism for ensuring the reliability and correctness of your deployments.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><code>Detail</code> showing as <code>Unsupported kind, skip</code> indicates that the health policy is not configured for this resource&#x27;s health check. This can occur due to several reasons:</p><ol><li>There&#x27;s a mismatch between the resource kind in your Kubernetes manifests and the kinds specified in your health policy.</li><li>The health policy in your workspace configuration might be missing or incorrectly defined for this particular resource.</li><li>You might forgot to updated your workspace with the new configuration.</li></ol><p>To resolve this:</p><ol><li>Review your workspace configuration to ensure the health policy is correctly defined for all intended resource kinds.</li><li>Check that the resource kind in your Kubernetes manifests matches the kinds specified in your health policy.</li></ol><p>If the issue persists, you may need to update your workspace configuration or adjust your health policy to include the specific resource kind.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">‚Äã</a></h2><ul><li>Keep your health check logic simple and focused on key indicators of health for your specific resource.</li><li>Use assertions to clearly define what conditions must be true for the resource to be considered healthy.</li><li>Consider both the desired state (e.g., number of replicas) and the current state (e.g., available replicas) in your health checks.</li><li>For complex resources, you may want to check multiple conditions to ensure full health and readiness.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">‚Äã</a></h2><ul><li>The customized health check feature is currently only available for Kubernetes resources.</li><li>The KCL script must complete execution within a reasonable time to avoid timeouts during the apply process.</li><li>Errors in the KCL script syntax will cause the health check to be skipped, so be sure to test your scripts thoroughly.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a href="#validation" class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation">‚Äã</a></h2><p>To verify the health policy, you can check the status of your Kubernetes resources:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get -n quickstart deployment quickstart-default-quickstart -o yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensure that the resource meets the conditions defined in your health policy.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>Customized health checks provides a powerful way to ensure your Kubernetes resources are in the desired state before considering an <code>apply</code> operation complete. By defining health policies, you can automate the validation of your resources and ensure they meet specific criteria before being considered healthy. By leveraging KCL, you can create sophisticated health check logic tailored to your specific <code>project</code> needs.</p><p>For more details on KCL and its syntax, refer to the <a href="/docs/v0.13/configuration-walkthrough/kcl-basics">KCL documentation</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/KusionStack/kusionstack.io/blob/main/docs_versioned_docs/version-v0.13/5-user-guides/2-working-with-k8s/10-customize-health-policy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-01-22T14:10:09.000Z">Jan 22, 2025</time></b> by <b>Yang Yang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v0.13/user-guides/working-with-k8s/k8s-manifest"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Apply the Raw K8s Manifest YAML</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v0.13/user-guides/observability/prometheus"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure Monitoring Behavior With Prometheus</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#defining-a-health-policy" class="table-of-contents__link toc-highlight">Defining a Health Policy</a><ul><li><a href="#example-health-policy" class="table-of-contents__link toc-highlight">Example Health Policy</a></li></ul></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How It Works</a></li><li><a href="#applying-the-health-policy" class="table-of-contents__link toc-highlight">Applying the Health Policy</a></li><li><a href="#explanation" class="table-of-contents__link toc-highlight">Explanation</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li><li><a href="#validation" class="table-of-contents__link toc-highlight">Validation</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Document</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Kusion</a></li><li class="footer__item"><a class="footer__link-item" href="/karpor/">Karpor</a></li><li class="footer__item"><a class="footer__link-item" href="/kuperator/introduction/">Kuperator</a></li><li class="footer__item"><a class="footer__link-item" href="/ctrlmesh/intro/">CtrlMesh</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resource</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.kusionstack.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/kusionstack/shared_invite/zt-19lqcc3a9-_kTNwagaT5qwBE~my5Lnxg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">KCL</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 KusionStack Authors. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d184186e.js"></script>
<script src="/assets/js/main.a76020de.js"></script>
</body>
</html>