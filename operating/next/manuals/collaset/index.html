<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-operating docs-doc-id-manuals/collaset">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">CollaSet | Evolve Your Internal Developer Platform with KusionStack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kusionstack.io/operating/next/manuals/collaset"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-operating-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-operating-current"><meta data-rh="true" property="og:title" content="CollaSet | Evolve Your Internal Developer Platform with KusionStack"><meta data-rh="true" name="description" content="CollaSet is responsible for managing a set of Pods. Similar to Kubernetes Deployment and StatefulSet, it also supports scaling and updating Pods. Additionally, CollaSet offers advanced features to provide users with more granular control over managing Pods."><meta data-rh="true" property="og:description" content="CollaSet is responsible for managing a set of Pods. Similar to Kubernetes Deployment and StatefulSet, it also supports scaling and updating Pods. Additionally, CollaSet offers advanced features to provide users with more granular control over managing Pods."><link data-rh="true" rel="icon" href="/img/kusionstack-icon-square.png"><link data-rh="true" rel="canonical" href="https://kusionstack.io/operating/next/manuals/collaset"><link data-rh="true" rel="alternate" href="https://kusionstack.io/operating/next/manuals/collaset" hreflang="en"><link data-rh="true" rel="alternate" href="https://kusionstack.io/zh/operating/next/manuals/collaset" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kusionstack.io/operating/next/manuals/collaset" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RE5E6BQUZV-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Evolve Your Internal Developer Platform with KusionStack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Evolve Your Internal Developer Platform with KusionStack Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XC4Z27TLBR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XC4Z27TLBR",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Evolve Your Internal Developer Platform with KusionStack" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.882ddf03.css">
<link rel="preload" href="/assets/js/runtime~main.1a495b6f.js" as="script">
<link rel="preload" href="/assets/js/main.a05db605.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like KusionStack, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/KusionStack/kusion">Github</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kusionstack-icon.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/kusionstack-icon-white.png" alt="KusionStack Icon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">KusionStack</b></a><a class="navbar__item navbar__link" href="/docs/">Kusion</a><a class="navbar__item navbar__link" href="/karpor/">Karpor</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/operating/next/introduction/">Operating</a><a class="navbar__item navbar__link" href="/ctrlmesh/intro/">Ctrlmesh</a><a class="navbar__item navbar__link" href="/community/intro/">Community</a><a href="https://blog.kusionstack.io" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/operating/next/introduction/">v0.5 üöß</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/operating/next/manuals/collaset">v0.5 üöß</a></li><li><a class="dropdown__link" href="/operating/manuals/collaset">v0.4</a></li><li><a class="dropdown__link" href="/operating/v0.3/manuals/collaset">v0.3</a></li></ul></div><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating/next/introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/operating/next/started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/operating/next/concepts/podopslifecycle">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/operating/next/manuals/collaset">Manuals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operating/next/manuals/collaset">CollaSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating/next/manuals/resourceconsist">ResourceConsist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating/next/manuals/podtransitionrule">PodTransitionRule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating/next/manuals/poddecoration">PodDecoration</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Evolve Your Internal Developer Platform with KusionStack<!-- --> <b>v0.5 üöß</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/operating/manuals/collaset">latest version</a></b> (<!-- -->v0.4<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Manuals</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CollaSet</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.5 üöß</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CollaSet</h1><p>CollaSet is responsible for managing a set of Pods. Similar to Kubernetes Deployment and StatefulSet, it also supports scaling and updating Pods. Additionally, CollaSet offers advanced features to provide users with more granular control over managing Pods.</p><p>A basic CollaSet configuration is represented in the following YAML format:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> collaset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s explore the features of CollaSet.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-features">Basic Features<a href="#basic-features" class="hash-link" aria-label="Direct link to Basic Features" title="Direct link to Basic Features">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaling-pods">Scaling Pods<a href="#scaling-pods" class="hash-link" aria-label="Direct link to Scaling Pods" title="Direct link to Scaling Pods">‚Äã</a></h3><p>CollaSet utilizes the field spec.replicas to indicate the number of Pods under management.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> collaset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># indicate the number of Pods to manage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pods can be provisioned by CollaSet.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default apply -f ./config/samples/apps_v1alpha1_collaset.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/collaset-sample created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-85q7g   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          57s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-vx5ws   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          57s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-hr7pv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          57s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get cls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME              DESIRED   CURRENT   UPDATED   UPDATED_READY   UPDATED_AVAILABLE   CURRENT_REVISION            UPDATED_REVISION            AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">               </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                   collaset-sample-6d7b7c58f   collaset-sample-6d7b7c58f   64s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By default, CollaSet always creates new Pods using the latest template specified in <code>spec.template</code>. CollaSet establishes ownership over a set of Pods through the label selector defined in <code>spec.selector</code>. Thus, it&#x27;s important to ensure that the labels provided in <code>spec.selector</code> match those in <code>spec.template.metadata.labels</code>.</p><p>CollaSet status provides general information about this CollaSet and all Pods under it.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get cls collaset-sample -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availableReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  collisionCount: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  conditions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - lastTransitionTime: </span><span class="token string" style="color:#e3116c">&quot;2023-09-01T03:56:09Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reason: Updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status: </span><span class="token string" style="color:#e3116c">&quot;True&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: Update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  currentRevision: collaset-sample-6d7b7c58f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  observedGeneration: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operatingReplicas: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  readyReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scheduledReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updatedAvailableReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updatedReadyReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updatedReplicas: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updatedRevision: collaset-sample-6d7b7c58f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Some fields in CollaSet status are explained here:</p><p><code>updatedRevision</code> indicates the latest revision that CollaSet uses to create or update Pods.</p><p><code>currentRevision</code> indicates the last updated revision. It will be set to updatedRevision after all Pods are updated, and their PodReady conditions become True.</p><p><code>replicas</code> indicates the count of Pods under this CollaSet.</p><p><code>scheduledReplicas</code> indicates the count of Pods under this CollaSet that successfully got scheduled.</p><p><code>availableReplicas</code> indicates the count of Pods under this CollaSet that have all expected finalizers attached.</p><p><code>updatedReplicas</code> indicates the count of Pods under this CollaSet that have the updated revision.</p><p><code>updatedReadyReplicas</code> indicates the count of Pods under this CollaSet that are counted in <code>updatedReplicas</code> and have their PodReady conditions set to True.</p><p><code>updatedAvailableReplicas</code> indicates the count of Pods under this CollaSet that is counted in <code>updatedReadyReplicas</code> and have all expected finalizers attached.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updating-pods">Updating Pods<a href="#updating-pods" class="hash-link" aria-label="Direct link to Updating Pods" title="Direct link to Updating Pods">‚Äã</a></h3><p>CollaSet generates Pods according to the pod template described in <code>spec.template</code>. This template can be updated to signal CollaSet to update each owned Pod:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.24.0  </span><span class="token comment" style="color:#999988;font-style:italic"># changed from nginx:1.25.2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CollaSet immediately updates all Pods it owns with the new Pod template by default.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The update progress can be controlled using partition.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="partition">Partition<a href="#partition" class="hash-link" aria-label="Direct link to Partition" title="Direct link to Partition">‚Äã</a></h4><p>Similar to StatefulSet, <code>partition</code> is used to control the upgrade progress.</p><p>By default, if not indicated, all Pods will be updated when spec.template changes. The <code>partition</code> can be adjusted from 0 to <code>spec.replicas</code> to specify how many Pods CollaSet should update. <strong>Unlike StatefulSet, the partition in CollaSet represents the number of Pods to update.</strong></p><p>Let&#x27;s update the image back to nginx:1.25.2:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.25.2  </span><span class="token comment" style="color:#999988;font-style:italic"># changed from nginx:1.24.0 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      byPartition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        partition: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># use partition to control upgrade progress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, CollaSet only updates 1 Pod to the updated revision.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.25.2   </span><span class="token comment" style="color:#999988;font-style:italic"># only 1 Pod updated</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-by-label">Update by Label<a href="#update-by-label" class="hash-link" aria-label="Direct link to Update by Label" title="Direct link to Update by Label">‚Äã</a></h4><p>By configuring the <code>byLabel</code> rolling update policy, users can precisely specify which Pods they want to update by using labels.</p><p>If you go back to the sample in the <a href="#Partition">section Partition</a> and change <code>byPartition</code> to <code>byLabel</code> like the following:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     byPartition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       partition: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     byLabel: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Subsequently, each Pod will only be updated if it&#x27;s marked with the label <code>collaset.kusionstack.io/update-included</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-features">Advanced Features<a href="#advanced-features" class="hash-link" aria-label="Direct link to Advanced Features" title="Direct link to Advanced Features">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod-instance-id">Pod Instance ID<a href="#pod-instance-id" class="hash-link" aria-label="Direct link to Pod Instance ID" title="Direct link to Pod Instance ID">‚Äã</a></h3><p>Each Pod created by CollaSet has a unique ID held by the label <code>collaset.kusionstack.io/instance-id</code>, which can be used to identify each individual Pod.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">collaset.kusionstack.io/instance-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Pod instance ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CollaSet provides a context to specify an ID pool, which defaults to the same name as the CollaSet and is immutable.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;id</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pool</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The same ID pool name can be indicated for multiple CollaSets, allowing them to share a single ID pool. Consequently, each Pod created by these CollaSets will be assigned a unique ID.</p><p>For example, these are two CollaSets with the same context:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/sample.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scaleStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: foo    </span><span class="token comment" style="color:#999988;font-style:italic"># with the same context foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: nginx:1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample-b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scaleStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: foo    </span><span class="token comment" style="color:#999988;font-style:italic"># with the same context foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: nginx:1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then create these CollaSets with the sample file:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default apply -f ~/sample.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/collaset-sample-a created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/collaset-sample-b created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-a-g4sjj   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-a-ph9vc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-b-fqkq4   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-b-lqg8f   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> collaset.kusionstack.io/instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, the 4 Pods created by these 2 CollaSets will have a unique instance ID.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="revision-consistency">Revision Consistency<a href="#revision-consistency" class="hash-link" aria-label="Direct link to Revision Consistency" title="Direct link to Revision Consistency">‚Äã</a></h3><p>Pods within a CollaSet can utilize more than two different Pod templates simultaneously, including both the current and updated revisions. This can result from partial updates. To ensure the stability of Pod revisions over time, CollaSet records this information. When a Pod is deleted, CollaSet recreates it using its previous revision.</p><p>It can be reproduced by following steps:</p><ol><li>Provision a new CollaSet with replicas 3.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default apply -f ./config/samples/apps_v1alpha1_collaset.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/collaset-sample created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-5tgcs    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-glgnb    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-qs46r    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get cls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME              DESIRED   CURRENT   UPDATED   UPDATED_READY   UPDATED_AVAILABLE   CURRENT_REVISION            UPDATED_REVISION            AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">               </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">                   collaset-sample-6d7b7c58f   collaset-sample-6d7b7c58f   64s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Update the image of PodTemplate of the CollaSet to image nginx:1.24.0 and set the partition to 2. Then there will be 2 Pods with image nginx:1.24.0 and 1 Pod with image nginx:1.25.2.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.24.0  </span><span class="token comment" style="color:#999988;font-style:italic"># changed from nginx:1.25.2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      byPartition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        partition: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># update 2 Pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Wait until these 2 Pods are updated, and check the Pod&#x27;s images.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Update the image of PodTemplate of the CollaSet to image nginx:1.23.4 and set the partition to 1.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.23.4  </span><span class="token comment" style="color:#999988;font-style:italic"># changed from nginx:1.24.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      byPartition:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        partition: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># update 1 Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Wait until the Pod is updated, and check the Pod&#x27;s images.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0   </span><span class="token comment" style="color:#999988;font-style:italic"># Pod collaset-sample-qs46r</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.23.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, there are 3 Pods, each of which has an individual image. If we then delete the Pod with the image nginx:1.24.0, the new Pod replacing it will be created with the same image nginx:1.24.0 in order for the Pod to inherit the revision.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete -n default delete pod collaset-sample-qs46r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">&quot;collaset-sample-qs46r&quot;</span><span class="token plain"> deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     READY   STATUS    RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-5tgcs    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">             3h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-ht9x6    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">             2m27s  </span><span class="token comment" style="color:#999988;font-style:italic"># Pod recreated</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-qs46r    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">3h ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    3h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.25.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0   </span><span class="token comment" style="color:#999988;font-style:italic"># image has not been changed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.23.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="in-place-update-pod">In-Place Update Pod<a href="#in-place-update-pod" class="hash-link" aria-label="Direct link to In-Place Update Pod" title="Direct link to In-Place Update Pod">‚Äã</a></h3><p>In addition to the <code>Recreate</code> update policy, which is identical to Deployment and StatefulSet, CollaSet offers the <code>InPlaceIfPossible</code> update policy.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> collaset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">podUpgradePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InPlaceIfPossible  </span><span class="token comment" style="color:#999988;font-style:italic"># Options: InPlaceIfPossible, Recreate, Replace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>InPlaceIfPossible</code> is the default value, which instructs CollaSets to try to update Pods in place when only container images, labels, and annotations have changed. If some other fields have changed too, the policy will back off to the <code>Recreate</code> policy.</p><p><code>Recreate</code> indicates CollaSets always delete the old Pod and create a new one with an updated revision.</p><p>If update pod template with <code>InPlaceIfPossible</code> policy as following example, the Pod will not be recreated.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: collaset-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.24.0  </span><span class="token comment" style="color:#999988;font-style:italic"># changed from nginx:1.25.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    podUpgradePolicy: InPlaceIfPossible </span><span class="token comment" style="color:#999988;font-style:italic"># use InPlaceIfPossible policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image: nginx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: nginx:1.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     READY   STATUS    RESTARTS     AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-5wvlh    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">6s ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   2m10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-ldvrg    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">6s ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   2m10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-pbz75    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">6s ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   2m10s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replace-update-pod">Replace Update Pod<a href="#replace-update-pod" class="hash-link" aria-label="Direct link to Replace Update Pod" title="Direct link to Replace Update Pod">‚Äã</a></h3><p>CollaSet provides the <code>Replace</code> policy for certain applications that are sensitive to the available number of Pods.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> collaset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">podUpgradePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Replace  </span><span class="token comment" style="color:#999988;font-style:italic"># Options: InPlaceIfPossible, Recreate, Replace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>Replace</code> policy indicates that CollaSet should update a Pod by creating a new one to replace it.
Unlike the <code>Recreate</code> policy, which deletes the old Pod before creating a new updated one, or the <code>InPlaceIfPossible</code> policy, which updates the current Pod in place,
the <code>Replace</code> policy first creates a new Pod with the updated revision. It then deletes the old Pod once the new one becomes available for service.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Before updating CollaSet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-dwkls   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          6m55s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># After updating CollaSet, the updated Pod is created first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS              RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-dwkls   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          6m55s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-rcmbv   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Once the created Pod is available for service, the old Pod will be deleted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS              RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-rcmbv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-dwkls   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7m12s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The two Pods will have a pair of labels to identify their relationship. The new Pod will have the label <code>collaset.kusionstack.io/replace-pair-origin-name</code> to indicate the name of the old Pod, and the old Pod will have the label <code>collaset.kusionstack.io/replace-pair-new-id</code> to indicate the instance ID of the new Pod.</p><p>Additionally, the new Pod and old Pod will each begin their own PodOpsLifecycles, which are independent of each other.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recreate-and-replace-specified-pod">Recreate And Replace Specified Pod<a href="#recreate-and-replace-specified-pod" class="hash-link" aria-label="Direct link to Recreate And Replace Specified Pod" title="Direct link to Recreate And Replace Specified Pod">‚Äã</a></h3><p>In practice, users often need to recreate or replace specified Pods under a CollaSet.</p><p>To delete a Pod, users can simply call the Kubernetes API, like executing <code>kubectl delete pod &lt;pod-name&gt;</code>.
However, this will bypass the <a href="https://www.kusionstack.io/docs/operating/concepts/podopslifecycle" target="_blank" rel="noopener noreferrer">PodOpsLifecycle</a> Mechanism.
We provide following two options:</p><ol><li>Enable the feature <code>GraceDeleteWebhook</code> so that it is possible to delete Pods through <code>PodOpsLifecycle</code>.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Enable the GraceDeleteWebhook feature when starting the controller with this argument</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /manager --feature-gates</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">GraceDeleteWebhook</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-vqccr   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          21s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Delete the pod directly. A message will respond indicating that the Pod deletion is handled by PodOpsLifecycle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n default delete pod collaset-sample-vqccr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error from server </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">failed to validate GraceDeleteWebhook, pod deletion process is underway and being managed by PodOpsLifecycle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: admission webhook </span><span class="token string" style="color:#e3116c">&quot;validating-pod.apps.kusionstack.io&quot;</span><span class="token plain"> denied the request: failed to validate GraceDeleteWebhook, pod deletion process is underway and being managed by PodOpsLifecycle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The old Pod is deleted, and a new Pod will be created </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-vqccr   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          71s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-vqccr   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          71s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-nbl6t   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-nbl6t   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-nbl6t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Label the Pod with <code>podopslifecycle.kusionstack.io/to-delete</code>, so that CollaSet will delete the Pod through PodOpsLifecycle.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Label Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default label pod collaset-sample-nbl6t podopslifecycle.kusionstack.io/to-delete</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The old Pod is deleted, and a new Pod will be recreated </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-nbl6t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m28s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-nbl6t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m28s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-w6x69   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-w6x69   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-w6x69   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Recreating a Pod will delete the old Pod first and then create a new one. This will affect the available Pod count.
To avoid this, CollaSet provides a feature to replace Pods by labeling them with <code>podopslifecycle.kusionstack.io/to-replace</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Replace Pod by label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n </span><span class="token builtin class-name">echo</span><span class="token plain"> label pod collaset-sample-w6x69 podopslifecycle.kusionstack.io/to-replace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The old Pod is deleted, and a new Pod will be created </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-w6x69   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-74fsv   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-74fsv   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-74fsv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset-sample-w6x69   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m33s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="supprting-pvcs">Supprting PVCs<a href="#supprting-pvcs" class="hash-link" aria-label="Direct link to Supprting PVCs" title="Direct link to Supprting PVCs">‚Äã</a></h3><p>CollaSet introduces support for PVCs, allowing user to declare <code>VolumeClaimTemplates</code> to create PVCs for each Pod.
Furthermore, in response to common issues with PVCs management, such as high modification costs and difficult control, CollaSet extends its functionality with the following advantages vs. StatefulSet:</p><ol><li>Support update, add and delete on <code>volumeClaimTemplates</code>.</li><li>Provide control over PVC lifecycle.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="provision-pvcs">Provision PVCs<a href="#provision-pvcs" class="hash-link" aria-label="Direct link to Provision PVCs" title="Direct link to Provision PVCs">‚Äã</a></h4><p>The <code>collaset-pvc.yaml</code> file declares a CollaSet with <code>VolumeClaimTemplates</code> to provision a PVC with <code>1Gi</code> storage for each Pod.
These PVCs are then mounted on the container at the path <code>/path/mount/www</code>.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kusionstack.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollaSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1.25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /path/mount/www </span><span class="token comment" style="color:#999988;font-style:italic"># path to mount PVC </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pods and PVCs can be provisioned by CollaSet.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default apply -f collaset-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-pw5lg   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-5n6ts   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-h5zv7   Bound    pvc-8a7d8ea0-ced0-423a-9255-bedfad0f2db6   1Gi        RWO            standard       7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-lswp2   Bound    pvc-9564b44b-9c99-467b-abee-4285183ff9c3   1Gi        RWO            standard       7s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each Pod and its related PVC have the same value of label <code>collaset.kusionstack.io/instance-id</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-pvcs">Update PVCs<a href="#update-pvcs" class="hash-link" aria-label="Direct link to Update PVCs" title="Direct link to Update PVCs">‚Äã</a></h4><p>To save the operating costs of PVCs, i.e. expand storage capacity, CollaSet supports update, add and delete on <code>volumeClaimTemplates</code>.</p><p>To achieve this, for each PVC, CollaSet calculates a hash value based on its template, and attatch it to label <code>collaset.kusionstack.io/pvc-template-hash</code>.
Once users modify the templates, CollaSet recognizes, caculates a new hash value and attach it on new PVCs to replace old ones.</p><p>Let&#x27;s give it a try, update the storage of PVC template from <code>1Gi</code> to <code>2Gi</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> volumeClaimTemplates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     storageClassName: standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     volumeModes: Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     accessModes: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-        storage: 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+        storage: 2Gi </span><span class="token comment" style="color:#999988;font-style:italic"># update pvc template to expand storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are 2 new PVCs with <code>2Gi</code> storage created with different hash values.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-pw5lg   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-5n6ts   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-9nhz4   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-xb2gd   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-h5zv7   Terminating   pvc-8a7d8ea0-ced0-423a-9255-bedfad0f2db6   1Gi        RWO            standard       11s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-lswp2   Terminating   pvc-9564b44b-9c99-467b-abee-4285183ff9c3   1Gi        RWO            standard       11s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-cj2s9   Bound         pvc-647e2a81-7fc6-4f37-a835-e63da9172de3   2Gi        RWO            standard       5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-hp2t6   Bound         pvc-03d7536e-cd3f-465f-bd30-362a9510f0c9   2Gi        RWO            standard       5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> pvc-template-hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/pvc-template-hash: 594d8857f9 </span><span class="token comment" style="color:#999988;font-style:italic"># hash value of old pvc </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/pvc-template-hash: 594d8857f9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/pvc-template-hash: d78c5ff6b </span><span class="token comment" style="color:#999988;font-style:italic"># hash value of new pvc </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/pvc-template-hash: d78c5ff6b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For old Pvcs, users can retain them by configuring <code>whenScaled</code> policy to <code>Retain</code> .
Then old PVCs can be re-mount on its related Pod after rolling back.
Otherwise, old PVCs can be deleted by default policy <code>Delete</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-pvcs">Add PVCs<a href="#add-pvcs" class="hash-link" aria-label="Direct link to Add PVCs" title="Direct link to Add PVCs">‚Äã</a></h4><p>Add a PVC template <code>yyy</code>, which is mounted on the container at the path <code>/path/mount/yyy</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - mountPath: /path/mount/www </span><span class="token comment" style="color:#999988;font-style:italic"># path to mount PVC </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       - mountPath: /path/mount/yyy </span><span class="token comment" style="color:#999988;font-style:italic"># path to mount PVC </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+         name: yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumeClaimTemplates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storageClassName: standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMode: Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accessModes: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          storage: 2Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - metadata: </span><span class="token comment" style="color:#999988;font-style:italic"># added pvc template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     name: yyy </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     storageClassName: standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     volumeMode: Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     accessModes: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+         storage: 2Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, each pod has two PVCs, which include a new PVCs claimed by template <code>yyy</code> and one old PVC claimed by template <code>www</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-8wwsz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-9nhz4   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-hd2cv   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-xb2gd   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-cj2s9   Bound    pvc-647e2a81-7fc6-4f37-a835-e63da9172de3   2Gi        RWO            standard       25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-hp2t6   Bound    pvc-03d7536e-cd3f-465f-bd30-362a9510f0c9   2Gi        RWO            standard       25s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-yyy-c68nh   Bound    pvc-94ee5eff-2350-4cb7-8411-85f0928d25fc   2Gi        RWO            standard       3s </span><span class="token comment" style="color:#999988;font-style:italic"># new pvc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-yyy-vpwss   Bound    pvc-8363dc78-3340-47d0-aa11-0adac36308d5   2Gi        RWO            standard       3s </span><span class="token comment" style="color:#999988;font-style:italic"># new pvc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="delete-pvcs">Delete PVCs<a href="#delete-pvcs" class="hash-link" aria-label="Direct link to Delete PVCs" title="Direct link to Delete PVCs">‚Äã</a></h4><p>Delete the PVC template <code>yyy</code> on CollaSet.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: nginx:1.25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - mountPath: /path/mount/www </span><span class="token comment" style="color:#999988;font-style:italic"># path to mount PVC </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       - mountPath: /path/mount/yyy </span><span class="token comment" style="color:#999988;font-style:italic"># path to mount PVC </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-         name: yyy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumeClaimTemplates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storageClassName: standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMode: Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accessModes: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          storage: 2Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - metadata: </span><span class="token comment" style="color:#999988;font-style:italic"># delete pvc template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     name: yyy </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     storageClassName: standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     volumeMode: Filesystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     accessModes: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-         storage: 2Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, PVCs claimed by template <code>yyy</code> are deleted and the origin PVCs claimed by template <code>www</code> are retained.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-6qcpc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-z2jqv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-8wwsz   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          38s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-hd2cv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          38s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-cj2s9   Bound         pvc-647e2a81-7fc6-4f37-a835-e63da9172de3   2Gi        RWO            standard       61s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-hp2t6   Bound         pvc-03d7536e-cd3f-465f-bd30-362a9510f0c9   2Gi        RWO            standard       61s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-yyy-c68nh   Terminating   pvc-94ee5eff-2350-4cb7-8411-85f0928d25fc   2Gi        RWO            standard       39s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-yyy-vpwss   Terminating   pvc-8363dc78-3340-47d0-aa11-0adac36308d5   2Gi        RWO            standard       39s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pvc-retention-policy">PVC Retention Policy<a href="#pvc-retention-policy" class="hash-link" aria-label="Direct link to PVC Retention Policy" title="Direct link to PVC Retention Policy">‚Äã</a></h4><p>CollaSet provides control over PVC lifecycle by configuring <code>spec.persistentVolumeClaimRetentionPolicy</code>.
Users can retain or delete PVCs after its related Pod is scaled down or CollaSet is deleted, respectively.
This feature is also supported by <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#persistentvolumeclaim-retention" target="_blank" rel="noopener noreferrer">StatefulSet</a> since v1.27.
Basic rule is detailed as follows:</p><ul><li><code>whenScale</code> : decides to delete or retain PVCs after Pod is scaled down.</li><li><code>whenDeleted</code>: decides to delete or retain PVCs after CollaSet is deleted.</li></ul><p>For each policy users can set the value to either Delete (by default) or Retain.
Note that for StatefulSet, the default policy is Retain.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="whenscaled">whenScaled<a href="#whenscaled" class="hash-link" aria-label="Direct link to whenScaled" title="Direct link to whenScaled">‚Äã</a></h4><p>Apply <code>collaset-pvc.yaml</code> and edit foo to scale replicas to 1.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f collaset-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-  replicas: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+  replicas: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># scale in 1 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the <code>whenScaled</code> is not configured, thus its value is <code>Delete</code> by default.
Consequently, PVC <code>foo-www-wzwbq</code> is deleted as its related Pod <code>foo-tkc5m</code>  is scaling down.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-tkc5m   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          27s </span><span class="token comment" style="color:#999988;font-style:italic"># related pvc is terminating</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-vwtcm   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          27s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-wzwbq   Terminating   pvc-b92c28c6-59ad-4976-810c-8d538c4a22c6   1Gi        RWO            standard       29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-r4vlh   Bound         pvc-dd7f7cce-a3cb-4bba-a106-e5ad264959a2   1Gi        RWO            standard       29s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Set <code>Retain</code> to <code>whenScaled</code>, and scale replicas to 0.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-  replicas: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+  replicas: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># scale in 1 pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       app: foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+  scaleStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+    persistentVolumeClaimRetentionPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+      whenScaled: Retain </span><span class="token comment" style="color:#999988;font-style:italic"># retain the pvc after pod is scaled down</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pod <code>foo-vwtcm</code> is terminating, while its related PVC <code>foo-www-r4vlh</code> is retained.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS        RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-vwtcm -n default   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          62s </span><span class="token comment" style="color:#999988;font-style:italic"># related pvc is retained</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-r4vlh   Bound    pvc-dd7f7cce-a3cb-4bba-a106-e5ad264959a2   1Gi        RWO            standard       63s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To validate the retention policy, try ro scale replicas to 2, and the remaining PVC should be mounted again.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-  replicas: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+  replicas: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># scale out 2 pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see that PVC <code>foo-www-r4vlh</code> is retained by Pod <code>foo-px487</code> as they have the same <code>instance-id</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-ld5xc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          27s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-px487   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          27s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-d48gx   Bound    pvc-1884ee45-5cc9-48ee-b01a-20f5ad63d6d4   1Gi        RWO            standard       29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-r4vlh   Bound    pvc-dd7f7cce-a3cb-4bba-a106-e5ad264959a2   1Gi        RWO            standard       2m47s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod foo-px487 -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc foo-www-r4vlh -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># pvc foo-www-r4vlh is retained</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="whendelete">whenDelete<a href="#whendelete" class="hash-link" aria-label="Direct link to whenDelete" title="Direct link to whenDelete">‚Äã</a></h4><p>Edit <code>foo</code> to configure <code>Retain</code> policy for <code>whenDelete</code>, and then delete this CollaSet.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default edit cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   scaleStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     persistentVolumeClaimRetentionPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       whenScaled: Retain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+      whenDelete: Retain </span><span class="token comment" style="color:#999988;font-style:italic"># retain the pvc after collaset is deleted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo edited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default delete cls foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token plain"> deleted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, try to recreate <code>foo</code> with 2 replicas, and the result shows both PVCs are retained.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default apply -f collaset-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collaset.apps.kusionstack.io/foo created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-qhh8t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-ss255   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-d48gx   Bound    pvc-1884ee45-5cc9-48ee-b01a-20f5ad63d6d4   1Gi        RWO            standard       4m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo-www-r4vlh   Bound    pvc-dd7f7cce-a3cb-4bba-a106-e5ad264959a2   1Gi        RWO            standard       6m47s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pod foo-px487 -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n default get pvc foo-www-r4vlh -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> instance-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># pvc foo-www-d48gx is retained</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collaset.kusionstack.io/instance-id: </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># pvc foo-www-r4vlh is retained</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/operating/next/concepts/podopslifecycle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PodOpsLifecycle</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operating/next/manuals/resourceconsist"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ResourceConsist</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-features" class="table-of-contents__link toc-highlight">Basic Features</a><ul><li><a href="#scaling-pods" class="table-of-contents__link toc-highlight">Scaling Pods</a></li><li><a href="#updating-pods" class="table-of-contents__link toc-highlight">Updating Pods</a></li></ul></li><li><a href="#advanced-features" class="table-of-contents__link toc-highlight">Advanced Features</a><ul><li><a href="#pod-instance-id" class="table-of-contents__link toc-highlight">Pod Instance ID</a></li><li><a href="#revision-consistency" class="table-of-contents__link toc-highlight">Revision Consistency</a></li><li><a href="#in-place-update-pod" class="table-of-contents__link toc-highlight">In-Place Update Pod</a></li><li><a href="#replace-update-pod" class="table-of-contents__link toc-highlight">Replace Update Pod</a></li><li><a href="#recreate-and-replace-specified-pod" class="table-of-contents__link toc-highlight">Recreate And Replace Specified Pod</a></li><li><a href="#supprting-pvcs" class="table-of-contents__link toc-highlight">Supprting PVCs</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Document</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Kusion</a></li><li class="footer__item"><a class="footer__link-item" href="/karpor/">Karpor</a></li><li class="footer__item"><a class="footer__link-item" href="/operating/">Operating</a></li><li class="footer__item"><a class="footer__link-item" href="/ctrlmesh/intro/">CtrlMesh</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resource</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.kusionstack.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/KusionStack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/kusionstack/shared_invite/zt-19lqcc3a9-_kTNwagaT5qwBE~my5Lnxg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kcl-lang.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">KCL</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.antgroup.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.svg" alt="AntGroup Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="160" height="51"><img src="/img/oss_logo.svg" alt="AntGroup Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="160" height="51"></a></div><div class="footer__copyright">Copyright ¬© 2024 KusionStack Authors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1a495b6f.js"></script>
<script src="/assets/js/main.a05db605.js"></script>
</body>
</html>